<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Studio Calculator Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        
        /* –£–±–∏—Ä–∞–µ–º —Å—Ç—Ä–µ–ª–∫–∏ —É input number */
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ */
        .custom-radio:checked + div { 
            border-color: #7E73FD; 
            background-color: #eff6ff; 
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1);
        }

        /* --- –°–¢–ò–õ–ò –ß–ï–ö–ë–û–ö–°–û–í –ò –†–ê–î–ò–û --- */
        
        /* –°–æ—Å—Ç–æ—è–Ω–∏–µ "–ù–µ –æ—Ç–º–µ—á–µ–Ω–æ" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
        .check-icon {
            background-color: #ffffff; /* –ë–µ–ª—ã–π —Ñ–æ–Ω */
            border-color: #cbd5e1;     /* –°–µ—Ä—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã */
            color: transparent;        /* –ò–∫–æ–Ω–∫–∞ —Å–∫—Ä—ã—Ç–∞ */
            transition: all 0.2s ease;
        }

        /* –°–æ—Å—Ç–æ—è–Ω–∏–µ "–û—Ç–º–µ—á–µ–Ω–æ" */
        .custom-radio:checked + div .check-icon { 
            background-color: #7E73FD; /* –°–∏–Ω–∏–π —Ñ–æ–Ω */
            border-color: #7E73FD;
            color: #ffffff;            /* –ë–µ–ª–∞—è –≥–∞–ª–æ—á–∫–∞ */
            transform: scale(1.1);
        }
        
        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

<!-- –®–∞–ø–∫–∞ (Sticky) -->
<header class="bg-white border-b border-slate-200 py-4 px-6 flex justify-between items-center shadow-sm z-30 relative">
    <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white text-xl shadow-blue-200 shadow-lg">
            <i class="fas fa-calculator"></i>
        </div>
        <div>
            <h1 class="font-bold text-lg leading-tight text-slate-800">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –°–º–µ—Ç—ã</h1>
            <p class="text-xs text-slate-500 font-medium">–î–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</p>
        </div>
    </div>
    <div class="text-right">
        <div class="text-xs text-slate-400 font-medium uppercase tracking-wider">–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞</div>
        <div class="text-2xl font-extrabold text-blue-600 tracking-tight" id="header-total">0 ‚ÇΩ</div>
    </div>
</header>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π –ª–µ–π–∞—É—Ç -->
<main class="flex-1 flex overflow-hidden relative">
    
    <!-- –õ–ï–í–ê–Ø –ü–ê–ù–ï–õ–¨: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–°–∫—Ä–æ–ª–ª) -->
    <div class="flex-1 overflow-y-auto custom-scroll p-4 md:p-8 pb-32 max-w-4xl mx-auto w-full" id="form-container">
        <!-- –°—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è JS -->
    </div>

    <!-- –ü–†–ê–í–ê–Ø –ü–ê–ù–ï–õ–¨: –ß–µ–∫ (–°–∫—Ä—ã—Ç–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö, –≤–∏–¥–Ω–∞ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ) -->
    <div class="w-96 bg-white border-l border-slate-200 flex flex-col shadow-[0_0_40px_-10px_rgba(0,0,0,0.1)] z-20 hidden lg:flex">
        <div class="p-5 border-b border-slate-100 bg-slate-50/50 backdrop-blur-sm">
            <h2 class="font-bold text-slate-700 flex items-center gap-2 text-sm uppercase tracking-wide">
                <i class="fas fa-list-ul text-blue-500"></i> –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è
            </h2>
        </div>
        
        <div class="flex-1 overflow-y-auto custom-scroll p-5" id="receipt-list">
            <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
            <div class="h-full flex flex-col items-center justify-center text-slate-400 opacity-60">
                <i class="fas fa-calculator text-4xl mb-4 text-slate-200"></i>
                <p class="text-sm text-center">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–ª–µ–≤–∞,<br>—á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞—Å—á–µ—Ç</p>
            </div>
        </div>

        <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="p-5 border-t border-slate-200 bg-white">
            <div class="flex justify-between items-end mb-4">
                <span class="text-sm font-medium text-slate-500">–ö –æ–ø–ª–∞—Ç–µ:</span>
                <span class="text-3xl font-extrabold text-slate-900" id="sidebar-total">0 ‚ÇΩ</span>
            </div>
            <div class="grid grid-cols-3 gap-3">
                <!-- –£–±—Ä–∞–Ω—ã –∞–Ω–∏–º–∞—Ü–∏–∏ (animate-bounce, active:scale, transition –∏ group) -->
                <button onclick="copyEstimate()" class="col-span-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-blue-200">
                    <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ö–ü
                </button>
                <button onclick="softReset()" class="col-span-1 bg-white border border-slate-200 text-slate-500 hover:bg-red-50 hover:text-red-500 hover:border-red-200 font-semibold py-3 px-4 rounded-xl transition-colors text-sm flex items-center justify-center shadow-sm">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </div>
    </div>
</main>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (Toast) -->
<div id="toast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 translate-y-24 bg-slate-800 text-white px-6 py-3 rounded-full shadow-2xl transition-all duration-300 flex items-center gap-3 z-50 pointer-events-none opacity-0">
    <i class="fas fa-check-circle text-green-400"></i>
    <span id="toast-msg" class="font-medium">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</span>
</div>

<script>
    /* =========================================
       –ë–ê–ó–ê –î–ê–ù–ù–´–• –£–°–õ–£–ì (DATABASE)
       ========================================= */
    const services = [
        {
            id: "project_type",
            title: "1. –¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞",
            icon: "fa-rocket",
            type: "radio",
            options: [
                { id: "landing", label: "Landing Page", price: 10000, desc: "–ü—Ä–æ–¥–∞—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (1-5 —ç–∫—Ä–∞–Ω–æ–≤)" },
                { id: "wiki", label: "Wiki –∏–ª–∏ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è", price: 10000, desc: "–î–æ–∫—É–º–µ—Ç–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–π –∏ –∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤" },
                { id: "shop", label: "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω", price: 15000, desc: "–ö–æ—Ä–∑–∏–Ω–∞, –æ–ø–ª–∞—Ç–∞, –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç" },
                { id: "forum", label: "–§–æ—Ä—É–º", price: 15000, desc: "–§–æ—Ä—É–º –¥–ª—è –æ–±—â–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã" },
                { id: "corporate", label: "–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∞–π—Ç", price: 25000, desc: "–ú–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∏–∫ –æ –∫–æ–º–ø–∞–Ω–∏–∏" }
            ]
        },
        {
            id: "design_tier",
            title: "2. –î–∏–∑–∞–π–Ω –∏ UI/UX",
            icon: "fa-palette",
            type: "radio",
            options: [
                { id: "tpl", label: "–î–∏–∑–∞–π–Ω (–®–∞–±–ª–æ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ)", price: 5000, desc: "–ê–¥–∞–ø—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–æ–π —Ç–µ–º—ã" },
                { id: "clean", label: "–î–∏–∑–∞–π–Ω (–ë–∞–∑–æ–≤—ã–π)", price: 10000, desc: "–ú–∏–Ω–∏–º–∞–ª–∏–∑–º, –ø—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ" },
                { id: "medium", label: "–î–∏–∑–∞–π–Ω (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)", price: 15000, desc: "–õ—é–±–æ–π —Å—Ç–∏–ª—å, –≥–ª—É–±–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ" },
                { id: "wow", label: "–ü—Ä–µ–º–∏—É–º –¥–∏–∑–∞–π–Ω (WOW-—ç—Ñ—Ñ–µ–∫—Ç)", price: 45000, desc: "–°–ª–æ–∂–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è, 3D —ç–ª–µ–º–µ–Ω—Ç—ã" }
            ]
        },
        {
            id: "cms",
            title: "3. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ (CMS)",
            icon: "fa-server",
            type: "radio",
            options: [
                { id: "nocode", label: "Tilda", price: 2500, desc: "–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä" },
                { id: "wp", label: "WordPress", price: 5000, desc: "–£–¥–æ–±–Ω–∞—è –∞–¥–º–∏–Ω–∫–∞, –ø–æ–ø—É–ª—è—Ä–Ω–∞—è CMS" },
                { id: "wpplus", label: "WordPress+", price: 6500, desc: "–¢–æ–∂–µ —Å–∞–º–æ–µ —á—Ç–æ –∏ WordPress –Ω–æ —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º –Ω–µ —à–∞–±–ª–æ–Ω–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º" },
                { id: "code", label: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –Ω—É–ª—è (–ë–∞–∑–æ–≤–∞—è)", price: 10000, desc: "–î–ª—è Landing Page –∏ –¥—Ä—É–≥–∏—Ö –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è–æ–Ω–Ω—ã—Ö —Å–∞–π—Ç–æ–≤" },
                { id: "code", label: "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –Ω—É–ª—è (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è)", price: 25000, desc: "–î–ª—è –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∏–∫–æ–≤ –∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –º–∞–≥–∞–∑–∏–Ω–æ–≤" }
            ]
        },
        {
            id: "content",
            title: "4. –ö–æ–Ω—Ç–µ–Ω—Ç –∏ –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ",
            icon: "fa-file-signature",
            type: "qty_inputs",
            inputs: [
                { id: "pages", label: "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã", price: 450, unit: "—Å—Ç—Ä.", desc: "–í–µ—Ä—Å—Ç–∫–∞ + –ö–æ–Ω—Ç–µ–Ω—Ç" },
            ]
        },
        {
            id: "features",
            title: "5. –ú–æ–¥—É–ª–∏ –∏ –§—É–Ω–∫—Ü–∏–∏",
            icon: "fa-puzzle-piece",
            type: "checkbox",
            options: [
                { id: "form_calc", label: "–°–ª–æ–∂–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä", price: 3500 },
                { id: "quiz", label: "–ö–≤–∏–∑-–æ–ø—Ä–æ—Å–Ω–∏–∫", price: 2000 },
                { id: "delivery", label: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ (API)", price: 9000 },
                // { id: "crm", label: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è CRM", price: 12000 },
                { id: "application", label: "–ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏ –∏–ª–∏ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å", price: 2500 }
            ]
        },
        // {
        //     id: "marketing",
        //     title: "6. –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥",
        //     icon: "fa-bullhorn",
        //     type: "checkbox",
        //     options: [
        //         { id: "seo", label: "SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Start)", price: 15000 },
        //         { id: "copy", label: "–ö–æ–ø–∏—Ä–∞–π—Ç–∏–Ω–≥ (–ì–ª–∞–≤–Ω–∞—è)", price: 8000 },
        //         { id: "analytics", label: "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏", price: 5000 }
        //     ]
        // },
        {
            id: "conditions",
            title: "7. –£—Å–ª–æ–≤–∏—è",
            icon: "fa-stopwatch",
            type: "checkbox",
            options: [
                { id: "urgent", label: "–°—Ä–æ—á–Ω–æ—Å—Ç—å (x1.3)", price: 1.3, isMultiplier: true, desc: "+30% –∫ —Å–º–µ—Ç–µ" },
            ]
        }
    ];

    /* =========================================
       STATE & CORE LOGIC
       ========================================= */
    
    let state = {
        selected: {},
        quantities: {}
    };

    const container = document.getElementById('form-container');
    const totalEls = [document.getElementById('header-total'), document.getElementById('sidebar-total')];
    const receiptList = document.getElementById('receipt-list');

    function init() {
        container.innerHTML = '';
        
        services.forEach((section, idx) => {
            let contentHTML = '';

            if (section.type === 'radio' || section.type === 'checkbox') {
                contentHTML = section.options.map(opt => renderOptionHTML(section, opt)).join('');
            } else if (section.type === 'qty_inputs') {
                contentHTML = section.inputs.map(inp => renderQtyHTML(inp)).join('');
            }

            const html = `
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 mb-6 overflow-hidden">
                    <div class="w-full px-6 py-5 flex items-center justify-between bg-white border-b border-slate-100">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-slate-100 text-slate-500 flex items-center justify-center text-lg">
                                <i class="fas ${section.icon}"></i>
                            </div>
                            <span class="font-bold text-lg text-slate-700">${section.title}</span>
                        </div>
                    </div>
                    
                    <div class="block">
                        <div class="px-6 pb-6 pt-4">
                            <div class="grid grid-cols-1 gap-3 pt-2">
                                ${contentHTML}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        });
    }

    // HTML –¥–ª—è Radio/Checkbox
    function renderOptionHTML(section, opt) {
        const inputType = section.type;
        const nameAttr = section.type === 'radio' ? `name="${section.id}"` : '';
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ—Ä–º—É: –∫—Ä—É–≥ –¥–ª—è —Ä–∞–¥–∏–æ, –∫–≤–∞–¥—Ä–∞—Ç –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞
        const shapeClass = inputType === 'radio' ? 'rounded-full' : 'rounded-md';

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã
        let priceTag = '';
        if (opt.isMultiplier) {
            priceTag = `<span class="text-amber-600 font-bold bg-amber-50 px-2 py-1 rounded text-xs">+${Math.round((opt.price-1)*100)}%</span>`;
        } else if (opt.price === 0) {
            priceTag = `<span class="text-green-600 font-bold bg-green-50 px-2 py-1 rounded text-xs">FREE</span>`;
        } else {
            priceTag = `<span class="text-slate-500 font-medium text-sm">+${opt.price.toLocaleString()} ‚ÇΩ</span>`;
        }

        return `
            <label class="cursor-pointer relative block">
                <input type="${inputType}" ${nameAttr} 
                    id="opt_${opt.id}"
                    class="peer sr-only custom-radio" 
                    onchange="handleOptionChange('${section.id}', '${opt.id}', '${inputType}', ${opt.price}, ${opt.isMultiplier || false}, '${opt.label}')">
                
                <div class="p-4 rounded-xl border border-slate-200 hover:border-blue-400 bg-white flex justify-between items-center transition-all duration-200">
                    <div class="flex items-center gap-3">
                        <!-- –í–∏–¥–∏–º—ã–π —á–µ–∫–±–æ–∫—Å/—Ä–∞–¥–∏–æ (–ø—É—Å—Ç–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                        <div class="w-6 h-6 ${shapeClass} border-2 border-slate-300 flex items-center justify-center check-icon shrink-0 shadow-sm">
                            <i class="fas fa-check text-xs"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-slate-800 leading-tight">${opt.label}</div>
                            ${opt.desc ? `<div class="text-xs text-slate-400 mt-1">${opt.desc}</div>` : ''}
                        </div>
                    </div>
                    <div>${priceTag}</div>
                </div>
            </label>
        `;
    }

    // HTML –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–Ω–ø—É—Ç–æ–≤
    function renderQtyHTML(inp) {
        return `
            <div class="p-4 rounded-xl border border-slate-200 bg-slate-50/50 flex flex-col sm:flex-row sm:items-center justify-between gap-4 transition-colors hover:border-blue-200 hover:bg-white">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-slate-200 text-slate-500 flex items-center justify-center text-xs">
                        <i class="fas fa-times"></i>
                    </div>
                    <div>
                        <div class="font-medium text-slate-800">${inp.label}</div>
                        <div class="text-xs text-slate-400">${inp.price.toLocaleString()} ‚ÇΩ / ${inp.unit}</div>
                    </div>
                </div>
                <div class="flex items-center gap-2 bg-white p-1 rounded-lg border border-slate-300 shadow-sm">
                    <button onclick="changeQtyValue('${inp.id}', -1)" class="w-8 h-8 rounded hover:bg-slate-100 text-slate-600 font-bold transition-colors select-none">-</button>
                    <input type="number" id="qty_input_${inp.id}" value="0" min="0" 
                        class="w-12 text-center font-bold text-slate-800 outline-none"
                        oninput="handleQtyChange('${inp.id}', this.value, ${inp.price}, '${inp.label}', '${inp.unit}')">
                    <button onclick="changeQtyValue('${inp.id}', 1)" class="w-8 h-8 rounded hover:bg-blue-50 text-blue-600 font-bold transition-colors select-none">+</button>
                </div>
            </div>
        `;
    }

    /* =========================================
       HANDLERS
       ========================================= */

    window.handleOptionChange = function(sectionId, optId, type, price, isMult, label) {
        if (type === 'radio') {
            const section = services.find(s => s.id === sectionId);
            section.options.forEach(o => delete state.selected[o.id]);
        }
        
        const key = optId;
        const el = document.getElementById('opt_' + optId);
        
        if (el.checked) {
            state.selected[key] = { price, isMult, label, sectionId };
        } else {
            delete state.selected[key];
        }
        
        calculateTotal();
    }

    window.handleQtyChange = function(id, value, price, label, unit) {
        const val = parseInt(value) || 0;
        if (val > 0) {
            state.quantities[id] = { qty: val, price, label, unit };
        } else {
            delete state.quantities[id];
        }
        calculateTotal();
    }

    window.changeQtyValue = function(id, delta) {
        const input = document.getElementById(`qty_input_${id}`);
        let newVal = (parseInt(input.value) || 0) + delta;
        if (newVal < 0) newVal = 0;
        
        input.value = newVal;
        input.dispatchEvent(new Event('input'));
    }

    /* =========================================
       CALCULATION
       ========================================= */

    function calculateTotal() {
        let sum = 0;
        let mult = 1;
        let itemsHTML = '';
        let hasItems = false;

        for (const key in state.selected) {
            const item = state.selected[key];
            if (item.isMult) {
                mult *= item.price;
            } else {
                sum += item.price;
                itemsHTML += createReceiptItem(item.label, item.price);
                hasItems = true;
            }
        }

        for (const key in state.quantities) {
            const item = state.quantities[key];
            const cost = item.qty * item.price;
            sum += cost;
            itemsHTML += createReceiptItem(`${item.label} <span class="text-xs text-slate-400">(${item.qty} ${item.unit})</span>`, cost);
            hasItems = true;
        }

        const total = Math.round(sum * mult);

        for (const key in state.selected) {
            const item = state.selected[key];
            if (item.isMult) {
                const percent = Math.round((item.price - 1) * 100);
                itemsHTML += `
                    <div class="flex justify-between items-center py-2 border-b border-dashed border-slate-200 text-amber-600 animate-pulse">
                        <span class="text-sm font-semibold">‚ö° ${item.label}</span>
                        <span class="font-bold text-xs">+${percent}%</span>
                    </div>
                `;
            }
        }

        if (!hasItems && mult === 1) {
            receiptList.innerHTML = `
                <div class="h-full flex flex-col items-center justify-center text-slate-400 opacity-60">
                    <i class="fas fa-calculator text-4xl mb-4 text-slate-200"></i>
                    <p class="text-sm text-center">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–ª–µ–≤–∞,<br>—á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞—Å—á–µ—Ç</p>
                </div>`;
        } else {
            receiptList.innerHTML = itemsHTML;
        }

        totalEls.forEach(el => {
            el.innerText = total.toLocaleString() + ' ‚ÇΩ';
        });
    }

    function createReceiptItem(name, price) {
        return `
            <div class="flex justify-between items-start py-3 border-b border-slate-100 last:border-0">
                <span class="text-sm text-slate-700 w-2/3 leading-snug">${name}</span>
                <span class="text-sm font-bold text-blue-600 whitespace-nowrap">${price.toLocaleString()} ‚ÇΩ</span>
            </div>
        `;
    }

    /* =========================================
       UTILITIES
       ========================================= */

    window.softReset = function() {
        // –£–±—Ä–∞–ª confirm(), —Ç–∞–∫ –∫–∞–∫ –æ–Ω –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –º–µ—à–∞—Ç—å —Ä–∞–±–æ—Ç–µ –∫–Ω–æ–ø–∫–∏
        state = { selected: {}, quantities: {} };

        const allInputs = document.querySelectorAll('input');
        allInputs.forEach(input => {
            if (input.type === 'checkbox' || input.type === 'radio') {
                input.checked = false;
            } else if (input.type === 'number') {
                input.value = 0;
            }
        });

        calculateTotal();
        showToast('–†–∞—Å—á–µ—Ç –æ—á–∏—â–µ–Ω');
    }

    window.copyEstimate = function() {
        let text = `–°–ú–ï–¢–ê –ü–†–û–ï–ö–¢–ê\n–î–∞—Ç–∞: ${new Date().toLocaleDateString()}\n\n`;
        let totalVal = document.getElementById('sidebar-total').innerText;
        let hasContent = false;
        
        services.forEach(section => {
            let sectionLines = [];
            
            if (section.options) {
                section.options.forEach(opt => {
                    if (state.selected[opt.id]) {
                        const s = state.selected[opt.id];
                        const priceStr = s.isMult ? `+${Math.round((s.price-1)*100)}%` : `${s.price.toLocaleString()} ‚ÇΩ`;
                        sectionLines.push(`- ${s.label}: ${priceStr}`);
                    }
                });
            }
            
            if (section.inputs) {
                section.inputs.forEach(inp => {
                    if (state.quantities[inp.id]) {
                        const q = state.quantities[inp.id];
                        sectionLines.push(`- ${q.label} (${q.qty} ${q.unit}): ${(q.qty * q.price).toLocaleString()} ‚ÇΩ`);
                    }
                });
            }

            if (sectionLines.length > 0) {
                hasContent = true;
                text += `üîπ ${section.title.toUpperCase()}\n${sectionLines.join('\n')}\n\n`;
            }
        });

        if (!hasContent) {
            showToast('–°–º–µ—Ç–∞ –ø—É—Å—Ç–∞!');
            return;
        }

        text += `================================\n`;
        text += `–ò–¢–û–ì–û: ${totalVal}`;

        navigator.clipboard.writeText(text).then(() => {
            showToast('–ö–ü —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä!');
        });
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        document.getElementById('toast-msg').innerText = msg;
        t.style.opacity = '1';
        t.style.transform = 'translate(-50%, 0)';
        setTimeout(() => {
            t.style.opacity = '0';
            t.style.transform = 'translate(-50%, 96px)';
        }, 3000);
    }

    // –ó–∞–ø—É—Å–∫
    init();

</script>
</body>

</html>

